digraph projectOverview {
    graph[
        rankdir=LR,
        label="HyPCAR Overview",
        labelloc=t,
        fontsize=40,
        margin=0.3,
        nodesep=0.75,
        ranksep=0.75,
        splines=true,
        compound=true,
        fontname="roboto"
    ];

    node[
        shape=box,
        style="rounded,filled",
        fontname="roboto",
        fontsize=16,
        penwidth=2,
        margin=0.3
    ];

    // Data Generation Cluster
    subgraph cluster_dataGeneration {
        label=<<B>Data Generation</B>>;
        fontsize=30;
        style="rounded,filled";
        fillcolor="#ffbd5b";
        color="#ffc400";
        margin=20;
        penwidth=2;

        DG1[label="Generate Stellar\nParameters"];
        DG2[label="Generate Planetary\nParameters"];
        DG3[label="Generate Atmospheric\nParameters"];
        DG4[label="Radiative Transfer\nModel"];

        DG1 -> DG4;
        DG2 -> DG4;
        DG3 -> DG4;
    }

    // Detection Model (Standalone)
    DM1[
        shape=record,
        label="{Detection Model\nCNN|• Input: Transmittance\n   Spectra\n• Output: Molecule\n   Presence Probs}",
        fontsize=14,
        fillcolor="#CAE8FF",
        color="#007ACC",
        penwidth=2
    ];

    // Abundance Estimator (Standalone)
    AM1[
        shape=record,
        label="{Abundance Estimator|• Input: Detection Probs\n   + Transmittance Spectra\n• Output: Abundances\n   + Uncertainty}",
        fontsize=14,
        fillcolor="#FFEDB2",
        color="#FFA500",
        penwidth=2
    ];

    // MOPTE Optimization Cluster
    subgraph cluster_mopte {
        label=<<B>MOPTE Optimization</B>>;
        fontsize=30;
        penwidth=2;
        style="rounded,filled";
        fillcolor="#DFF1D8";
        color="#66B032";
        margin=20;

        MO1[
            shape=record,
            label="{MOPTE Optimizer|• Uses Evolutionary Algorithm\n• Penalizes Physically Implausible\n  Combinations\n• Outputs: Refined Parameters}",
            fontsize=14,
            fillcolor="#DFF1D8",
            color="#66B032",
            penwidth=2
        ];
    }

    // Physics Fine-Tuning Cluster
    subgraph cluster_physics {
        label=<<B>Physics Fine-Tuning</B>>;
        fontsize=30;
        penwidth=2;
        style="rounded,filled";
        fillcolor="#FFD3E0";
        color="#FF69B4";
        margin=20;

        PF1[
            shape=record,
            label="{Physics Module|• Applies PSG-based Loss\n• Enforces Conservation Laws\n• Improves Physical Plausibility}",
            fontsize=14,
            fillcolor="#FFD3E0",
            color="#FF69B4",
            penwidth=2
        ];
    }

    // Connections
    DG4 -> DM1 [ltail=cluster_dataGeneration, label="Spectra", fontsize=12];
    DG4 -> AM1 [ltail=cluster_dataGeneration, label="Spectra", fontsize=12];
    DM1 -> AM1 [label="Molecule Probabilities", fontsize=12];
    AM1 -> MO1 [lhead=cluster_mopte, label="Initial Abundances", fontsize=12];
    MO1 -> PF1 [ltail=cluster_mopte, lhead=cluster_physics, minlen=2, label="Optimized Parameters", fontsize=12];
    PF1 -> AM1 [style=dashed, color=gray, label="Backprop\n(Physical Loss)", fontsize=12];

    // Alignment
    { rank = same; DM1; AM1; }
}
